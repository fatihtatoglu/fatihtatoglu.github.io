<!DOCTYPE html><html lang="en"><head><base href="https://blog.tatoglu.net/"><meta charset="UTF-8"><meta name="yandex-verification" content="31a29a16b97b37a8"><meta name="msvalidate.01" content="578B5091D7C5A2C03BE2EE0DF0CCC024"><meta name="google-site-verification" content="7pv7CpUtN5qt6uIgrmkOjVK03wSJYs1vQKRiBESB978"><link rel="profile" href="https://gmpg.org/xfn/11"><meta name="description" content=""><meta name="author" content="Fatih TatoÄŸlu"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap&v=2072681207865d48723a908465cb5343" rel="stylesheet"><link rel="canonical" href="https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html"><link rel="alternate" hreflang="x-default" href="https://blog.tatoglu.net/lab/haproxy/ssl-certificate.html"><link rel="alternate" hreflang="tr" href="https://blog.tatoglu.net/lab/haproxy/ssl-certificate.html"><link rel="alternate" hreflang="en" href="https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fatih TatoÄŸlu - SSL Certificate</title><link rel="stylesheet" href="https://blog.tatoglu.net/css/main.css?v=2072681207865d48723a908465cb5343"><link rel="stylesheet" href="https://blog.tatoglu.net/css/custom.css?v=2072681207865d48723a908465cb5343"><link rel="apple-touch-icon" sizes="180x180" href="https://blog.tatoglu.net/image/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blog.tatoglu.net/image/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blog.tatoglu.net/image/favicon/favicon-16x16.png"><link rel="manifest" href="https://blog.tatoglu.net/image/favicon/site.webmanifest"><link rel="icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@fatihtatoglu"><meta name="twitter:title" content="SSL Certificate"><meta name="twitter:description" content=""><script type="application/ld+json">{"@context": "https://schema.org","@graph": [{"@type": "WebSite","@id": "https://blog.tatoglu.net/#website","url": "https://blog.tatoglu.net/","name": "Fatih TatoÄŸlu","description": "Fatih TatoÄŸlu - KiÅŸisel Web SayfasÄ±","publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"inLanguage": ""},{"@type": "WebPage","@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#webpage","url": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html","name": "SSL Certificate - Fatih TatoÄŸlu","isPartOf": {"@id": "https://blog.tatoglu.net/#website"},"datePublished": "2022-06-12T19:03:27+0000","breadcrumb": {"@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#breadcrumb"},"inLanguage": "","potentialAction": [{"@type": "ReadAction","target": ["https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html"]}]},{"@type": "BreadcrumbList","@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#breadcrumb","itemListElement": [{"@type": "ListItem","position": 1,"name": "Ana sayfa","item": "https://blog.tatoglu.net/"},{"@type": "ListItem","position": 2,"name": "SSL Certificate"}]},{"@type": "Article","@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#article","isPartOf": {"@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#webpage"},"author": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"headline": "SSL Certificate","datePublished": "2022-06-12T19:03:27+0000","mainEntityOfPage": {"@id": "https://blog.tatoglu.net/en/lab/haproxy/ssl-certificate.html/#webpage"},"publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"articleSection": ["lab"],"keywords": ["haproxy","ssl","tls","https","certificate","pfx","pem"],"inLanguage": ""},{"@type": ["Person"],"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034","name": "Fatih TatoÄŸlu","url": "https://blog.tatoglu.net/about-me.html","image": {"@type": "ImageObject","@id": "https://blog.tatoglu.net/#personlogo","inLanguage": "","url": "https://blog.tatoglu.net/image/about_me.jpg","contentUrl": "https://blog.tatoglu.net/image/about_me.jpg","width": 1024,"height": 683,"caption": "Fatih TatoÄŸlu"},"address": {"@type": "PostalAddress","addressLocality": "Ä°stanbul","addressCountry": "Turkey"},"email": "fatih@tatoglu.net"}]}</script></head><body><header><h1 id="title">SSL Certificate</h1><summary id="description"></summary></header><nav><i class="menu-icon">&#9776;</i><ul><li><a href="https://blog.tatoglu.net/en/index.html">Home Page</a></li><li><a href="https://blog.tatoglu.net/en/coaching/index.html">Coaching</a></li><li><a href="https://blog.tatoglu.net/en/my-notes/index.html">My Notes</a></li><li><a href="https://blog.tatoglu.net/en/lab/index.html">Laboratory</a></li><li><a href="https://blog.tatoglu.net/en/about-me.html">About Me</a></li><li><button id="btnFeedback" class="icon" title="Feedback">&#128640;</button> <button id="btnDarkTheme" class="icon" title="Dark Theme">&#127770;</button> <button id="btnLightTheme" class="icon" title="Light Theme">&#127774;</button> <button id="btnTurkish" class="icon" title="Turkish">ðŸ‡¹ðŸ‡·</button></li></ul></nav><main><section><strong>HAProxy</strong><ul><li><a href=".&#x2F;en&#x2F;lab&#x2F;haproxy&#x2F;setup.html">Setup</a></li><li><a href=".&#x2F;en&#x2F;lab&#x2F;haproxy&#x2F;cluster.html">Cluster</a></li><li><a href=".&#x2F;en&#x2F;lab&#x2F;haproxy&#x2F;default-routing.html">Static Routing</a></li><li class="active">SSL Certificate</li></ul></section><article><p>HAProxy can handle the SSL request if the SSL configuration is valid. Usually, the flow is that the request meets the <code>frontend</code> service, then it moves to the <code>backend</code> service. The SSL / TLS certification definition is seen on the <code>frontend</code> side. Before configuring the HAProxy, let&#39;s check the types of SSL definition strategies.</p><h2>TLS / SSL Offloading</h2><figure><img src="../image/tls-offloading.png" alt="TLS / SSL Offloading"><figcaption><p>TLS Offloading - <a href="https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/" rel="noopener noreferrer" target="_blank">HAProxy Encryption Strategies</a></p></figcaption></figure><p>With this strategy, the HAProxy encrypts messages between the client and itself, but the communication is not encrypted between itself and the backend servers. The SSL/TLS certificate is stored on the HAProxy servers.</p><h2>TLS / SSL Passthrough</h2><figure><img src="../image/tls-passthrough.png" alt="TLS / SSL Passthrough"><figcaption><p>TLS Passthrough - <a href="https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/" rel="noopener noreferrer" target="_blank">HAProxy Encryption Strategies</a></p></figcaption></figure><p>With this strategy, the HAProxy doesn&#39;t apply the encryption or decryption process. The backend servers are responsible for this operation. The request only conveys to the backend server without any operations, after matching with the correct routing rule.</p><h2>TLS / SSL Bridging</h2><figure><img src="../image/tls-bridging.png" alt="TLS / SSL Bridging"><figcaption><p>TLS Bridging - <a href="https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/" rel="noopener noreferrer" target="_blank">HAProxy Encryption Strategies</a></p></figcaption></figure><p>With this strategy, the HAProxy encrypts all the messages. The request reaches the HAProxy, and HAProxy decrypts the request for some operations, such as header validation. Then, the request is encrypted by the HAProxy to convey to the backend servers. The SSL / TLS certificate must be kept on both sides, HAProxy and backend servers.</p><h2>Configuration</h2><pre><code class="language-shell">devops@haproxy-01:~$ sudo vi /etc/haproxy/haproxy.conf
</code></pre><pre><code class="language-nestedtext">...
##################################################
#                    Frontend                    #
##################################################
frontend https_in
    mode http
    bind *:443 ssl crt /etc/haproxy/certificates/certificate-cert-key.pem

    ...

    default_backend be_default
##################################################


##################################################
#                    Backend                     #
##################################################
backend be_default
    mode http

    errorfile 503 /etc/haproxy/errors/503.http
##################################################
...
</code></pre><p>With the above config, the HAProxy can handle the SSL / TLS requests and convey them to the <code>backend</code> servers. Before validating the configuration, the SSL / TLS certificate must be located in the given location in the PEM format. HAProxy wants the PEM file contains the public and private key in order. For this operation, the below commands can be helpful.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo su
root@haproxy-01:/home/devops# openssl pkcs12 -in certificate.pfx -nocerts -out certificate_priv.pem -nodes
root@haproxy-01:/home/devops# openssl pkcs12 -in certificate.pfx -nokeys -out certificate_public.pem -nodes
root@haproxy-01:/home/devops# cat certificate_public.pem certificate_priv.pem &gt; certificate-cert-key.pem
root@haproxy-01:/home/devops# mv certificate-cert-key.pem /etc/haproxy/certificates/certificate-cert-key.pem
</code></pre><p>The command extracts the private and public keys first from the pfx file. You can use the below instructions if you have private and public keys separately.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo su
root@haproxy-01:/home/devops# cat certificate_public.pem certificate_priv.pem &gt; certificate-cert-key.pem
root@haproxy-01:/home/devops# mv certificate-cert-key.pem /etc/haproxy/certificates/certificate-cert-key.pem
</code></pre><p>Before applying this change, the config file must be validated.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo /opt/haproxy/sbin/haproxy -c -V -f /etc/haproxy/haproxy.conf
devops@haproxy-01:~$ sudo systemctl reload haproxy
</code></pre><p>If there is a cluster environment, the configuration must be applied to all servers.</p></article></main><footer>&copy; 1985 - <a href="en/about-me.html" rel="noopener noreferrer" target="_blank">Fatih TatoÄŸlu</a></footer><script src="https://blog.tatoglu.net/js/main.js?v=2072681207865d48723a908465cb5343"></script><script src="https://blog.tatoglu.net/js/analytics.js?v=2072681207865d48723a908465cb5343"></script><div id="pnlFeedbackSurvey"><div class="model-content"><button id="btnFeedbackSurveyClose" class="icon bold x-small">&times;</button><iframe src="https://docs.google.com/forms/d/e/1FAIpQLSewJ_x10HBlFs2lO2zHUBI3ZeSdEXaISpK292RPJBoZyeC1HA/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe></div></div></body></html>