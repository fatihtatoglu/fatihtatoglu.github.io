<!DOCTYPE html><html lang="tr"><head><base href="https://blog.tatoglu.net/"><meta charset="UTF-8"><meta name="yandex-verification" content="31a29a16b97b37a8"><meta name="msvalidate.01" content="578B5091D7C5A2C03BE2EE0DF0CCC024"><meta name="google-site-verification" content="Ovuv1WWfkBGnFfpFHwwPPQSv274GrePTq1hq1Oq0Xc8"><link rel="profile" href="https://gmpg.org/xfn/11"><meta name="description" content="HAProxy kendisine gelen SSL trafiğini de yönetebilmektedir. Bunun için ilk adım sertifika ayarlaması."><meta name="author" content="Fatih Tatoğlu"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel="canonical" href="https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html"><link rel="alternate" hreflang="x-default" href="https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html"><link rel="alternate" hreflang="tr" href="https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fatih Tatoğlu - HAProxy - SSL Sertifikası Ekleme</title><link rel="stylesheet" href="https://blog.tatoglu.net/css/main.css?v=23d1afd896bb2f0819307dbc56dd6adf"><link rel="stylesheet" href="https://blog.tatoglu.net/css/custom.css?v=23d1afd896bb2f0819307dbc56dd6adf"><link rel="stylesheet" href="https://blog.tatoglu.net/css/3024.css?v=23d1afd896bb2f0819307dbc56dd6adf"><script src="https://blog.tatoglu.net/js/main.js?v=23d1afd896bb2f0819307dbc56dd6adf"></script><script src="https://blog.tatoglu.net/js/analytics.js?v=23d1afd896bb2f0819307dbc56dd6adf"></script><link rel="apple-touch-icon" sizes="180x180" href="https://blog.tatoglu.net/image/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blog.tatoglu.net/image/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blog.tatoglu.net/image/favicon/favicon-16x16.png"><link rel="manifest" href="https://blog.tatoglu.net/image/favicon/site.webmanifest"><link rel="icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@fatihtatoglu"><meta name="twitter:title" content="HAProxy - SSL Sertifikası Ekleme"><meta name="twitter:description" content="HAProxy kendisine gelen SSL trafiğini de yönetebilmektedir. Bunun için ilk adım sertifika ayarlaması."><script type="application/ld+json">{"@context": "https://schema.org","@graph": [{"@type": "WebSite","@id": "https://blog.tatoglu.net/#website","url": "https://blog.tatoglu.net/","name": "Fatih Tatoğlu","description": "Fatih Tatoğlu - Kişisel Web Sayfası","publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"inLanguage": ""},{"@type": "WebPage","@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#webpage","url": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html","name": "HAProxy - SSL Sertifikası Ekleme - Fatih Tatoğlu","isPartOf": {"@id": "https://blog.tatoglu.net/#website"},"datePublished": "2022-06-12T19:03:27+0000","breadcrumb": {"@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#breadcrumb"},"inLanguage": "","potentialAction": [{"@type": "ReadAction","target": ["https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html"]}]},{"@type": "BreadcrumbList","@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#breadcrumb","itemListElement": [{"@type": "ListItem","position": 1,"name": "Ana sayfa","item": "https://blog.tatoglu.net/"},{"@type": "ListItem","position": 2,"name": "HAProxy - SSL Sertifikası Ekleme"}]},{"@type": "Article","@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#article","isPartOf": {"@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#webpage"},"author": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"headline": "HAProxy - SSL Sertifikası Ekleme","datePublished": "2022-06-12T19:03:27+0000","mainEntityOfPage": {"@id": "https://blog.tatoglu.net/kendime-notlar/lab/haproxy/ssl-sertifikasi-ekleme.html/#webpage"},"publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"keywords": ["haproxy","ssl","tls","https","sertifika"],"inLanguage": ""},{"@type": ["Person"],"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034","name": "Fatih Tatoğlu","url": "https://blog.tatoglu.net/about-me.html","image": {"@type": "ImageObject","@id": "https://blog.tatoglu.net/#personlogo","inLanguage": "","url": "https://blog.tatoglu.net/image/about_me.jpg","contentUrl": "https://blog.tatoglu.net/image/about_me.jpg","width": 1024,"height": 683,"caption": "Fatih Tatoğlu"},"address": {"@type": "PostalAddress","addressLocality": "İstanbul","addressCountry": "Turkey"},"email": "fatih@tatoglu.net"}]}</script></head><body><header><span class="site-name">Fatih Tatoğlu</span></header><nav id="navigation"><span class="menu-button">▼</span><ul><li><a href="javascript:;">-</a><div class="sub-menu"><ul><li><a id="btnSetting" href="javascript:;">Tema Ayarları</a></li></ul></div></li><li><a href="https://blog.tatoglu.net/index.html">Anasayfa</a></li><li><a href="https://blog.tatoglu.net/kocluk/index.html">Koçluk</a></li><li><a href="https://blog.tatoglu.net/projeler/index.html">Projeler</a></li><li><a href="https://blog.tatoglu.net/kendime-notlar/index.html">Kendime Notlar</a></li><li><a href="https://blog.tatoglu.net/hakkimda.html">Hakkımda</a></li></ul></nav><main><article data-clarity-region="article"><header><h1>HAProxy - SSL Sertifikası Ekleme</h1><button>#</button></header><p>HAProxy kendisine gelen SSL isteklerini de karşılayabilmektedir. Bu istekleri <code>backend</code> servislerine doğru aktarmak için <code>frontend</code> servislerinde doğru tanımların yapılması gerekmektedir.</p><p>HAProxy konfigürasyon dosyasını aşağıdaki gibi güncelliyoruz.</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">sudo vi /etc/haproxy/haproxy.conf</span>
</code></pre><pre><code class="hljs language-nestedtext">...
<span class="hljs-comment">##################################################</span>
<span class="hljs-comment">#                    Frontend                    #</span>
<span class="hljs-comment">##################################################</span>
frontend https_in
    mode http
    bind *:443 ssl crt /etc/haproxy/certificates/certificate-cert-key.pem

    ...

    default_backend be_default
<span class="hljs-comment">##################################################</span>


<span class="hljs-comment">##################################################</span>
<span class="hljs-comment">#                    Backend                     #</span>
<span class="hljs-comment">##################################################</span>
backend be_default
    mode http

    errorfile 503 /etc/haproxy/errors/503.http
<span class="hljs-comment">##################################################</span>
...
</code></pre><p>Bu ayar sayesinde artık 443 portundan gelen SSL isteklerini istediğiniz <code>backend</code> servisine aktarabilirsiniz. Konfigürasyonu doğrulamadan önce sertifikanın belirttiğiniz yerde olmasını sağlamamız gerekiyor. HAProxy hem public hem de private key&#39;in aynı dosyada peş peşe olmasını istiyor. Bunun için aşağıdaki komutları çalıştırabilirsiniz.</p><p>Ben bu işlemleri yaparken hep elimde pfx uzantılı sertifika dosyası oluyordu. Eğer sizin elinizde farklı formatlarda varsa mutlaka pem formatına ayarlamanız gerekecek.</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">sudo su</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">openssl pkcs12 -<span class="hljs-keyword">in</span> certificate.pfx -nocerts -out certificate_priv.pem -nodes</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">openssl pkcs12 -<span class="hljs-keyword">in</span> certificate.pfx -nokeys -out certificate_public.pem -nodes</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> certificate_public.pem certificate_priv.pem &gt; certificate-cert-key.pem</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> certificate-cert-key.pem /etc/haproxy/certificates/certificate-cert-key.pem</span>
</code></pre><p>Bu ayar uygulanmadan önce doğruluğu kontrol edilmeli ve sonrasında servisler güncellenerek yayına alınmalıdır.</p><p>Eğer cluster bir yapınız varsa iki makinede de aynı geliştirmenin yapılması gerekmektedir.</p><pre><code class="hljs language-shell">sudo /opt/haproxy/sbin/haproxy -c -V -f /etc/haproxy/haproxy.conf
sudo systemctl reload haproxy
</code></pre><footer>By <a href="about-me.html" rel="noopener noreferrer" target="_blank">Fatih Tatoğlu</a> - <time pubdate datetime="2022-06-12T19:03:27+0000" title="12.06.2022">12.06.2022</time></footer></article></main><footer><span class="credits">Fatih Tatoğlu &copy; 1985</span></footer><div id="pnlSettingDialog" class="dialog"><div class="dialog-box"><div class="dialog-content"><header><button>■</button><span>Tema Ayarları</span></header><main><table style="margin: auto;"><thead><th style="width: 150px;">Renkler</th></thead><tbody><tr><td style="text-align: left; padding-left: 5%;"><input id="rbColoraqua" name="color" type="radio" value="aqua"> <label for="rbColoraqua">Aqua</label><br><input id="rbColorblack" name="color" type="radio" value="black"> <label for="rbColorblack">Black</label><br><input id="rbColorblue" name="color" type="radio" value="blue"> <label for="rbColorblue">Blue</label><br><input id="rbColorwhite" name="color" type="radio" value="white"> <label for="rbColorwhite">White</label></td></tr></tbody></table><br></main><footer><button id="btnSettingDialogOK" class="default" accesskey="t"><u>T</u>amam</button></footer></div></div></div></body></html>