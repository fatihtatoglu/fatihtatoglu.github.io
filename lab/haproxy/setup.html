<!DOCTYPE html><html lang="tr"><head><base href="https://blog.tatoglu.net/"><meta charset="UTF-8"><meta name="yandex-verification" content="31a29a16b97b37a8"><meta name="msvalidate.01" content="578B5091D7C5A2C03BE2EE0DF0CCC024"><meta name="google-site-verification" content="Ovuv1WWfkBGnFfpFHwwPPQSv274GrePTq1hq1Oq0Xc8"><link rel="profile" href="https://gmpg.org/xfn/11"><meta name="description" content="Verimli yük dengeleme için CentOS 7.X'te HAProxy'yi kurun. Hazırlık, kurulum, yapılandırma ve güvenlik için adım adım talimatları izleyin. Sorunsuz bir dağıtım sağlayın."><meta name="author" content="Fatih Tatoğlu"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap&v=96a6c3c79b3d35ef37896ed4f9a413ce" rel="stylesheet"><link rel="canonical" href="https://blog.tatoglu.net/lab/haproxy/setup.html"><link rel="alternate" hreflang="x-default" href="https://blog.tatoglu.net/lab/haproxy/setup.html"><link rel="alternate" hreflang="tr" href="https://blog.tatoglu.net/lab/haproxy/setup.html"><link rel="alternate" hreflang="en" href="https://blog.tatoglu.net/en/lab/haproxy/setup.html"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fatih Tatoğlu - Kurulum</title><link rel="stylesheet" href="https://blog.tatoglu.net/css/main.css?v=96a6c3c79b3d35ef37896ed4f9a413ce"><link rel="stylesheet" href="https://blog.tatoglu.net/css/custom.css?v=96a6c3c79b3d35ef37896ed4f9a413ce"><link rel="apple-touch-icon" sizes="180x180" href="https://blog.tatoglu.net/image/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blog.tatoglu.net/image/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blog.tatoglu.net/image/favicon/favicon-16x16.png"><link rel="manifest" href="https://blog.tatoglu.net/image/favicon/site.webmanifest"><link rel="icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@fatihtatoglu"><meta name="twitter:title" content="Kurulum"><meta name="twitter:description" content="Verimli yük dengeleme için CentOS 7.X'te HAProxy'yi kurun. Hazırlık, kurulum, yapılandırma ve güvenlik için adım adım talimatları izleyin. Sorunsuz bir dağıtım sağlayın."><script type="application/ld+json">{"@context": "https://schema.org","@graph": [{"@type": "WebSite","@id": "https://blog.tatoglu.net/#website","url": "https://blog.tatoglu.net/","name": "Fatih Tatoğlu","description": "Fatih Tatoğlu - Kişisel Web Sayfası","publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"inLanguage": ""},{"@type": "WebPage","@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#webpage","url": "https://blog.tatoglu.net/lab/haproxy/setup.html","name": "Kurulum - Fatih Tatoğlu","isPartOf": {"@id": "https://blog.tatoglu.net/#website"},"datePublished": "2022-06-12T14:07:13+0000","breadcrumb": {"@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#breadcrumb"},"inLanguage": "","potentialAction": [{"@type": "ReadAction","target": ["https://blog.tatoglu.net/lab/haproxy/setup.html"]}]},{"@type": "BreadcrumbList","@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#breadcrumb","itemListElement": [{"@type": "ListItem","position": 1,"name": "Ana sayfa","item": "https://blog.tatoglu.net/"},{"@type": "ListItem","position": 2,"name": "Kurulum"}]},{"@type": "Article","@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#article","isPartOf": {"@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#webpage"},"author": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"headline": "Kurulum","datePublished": "2022-06-12T14:07:13+0000","mainEntityOfPage": {"@id": "https://blog.tatoglu.net/lab/haproxy/setup.html/#webpage"},"publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"articleSection": ["lab"],"keywords": ["haproxy","centos","lua","kurulum","kurma","kaynak kod","install","yükleme"],"inLanguage": ""},{"@type": ["Person"],"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034","name": "Fatih Tatoğlu","url": "https://blog.tatoglu.net/about-me.html","image": {"@type": "ImageObject","@id": "https://blog.tatoglu.net/#personlogo","inLanguage": "","url": "https://blog.tatoglu.net/image/about_me.jpg","contentUrl": "https://blog.tatoglu.net/image/about_me.jpg","width": 1024,"height": 683,"caption": "Fatih Tatoğlu"},"address": {"@type": "PostalAddress","addressLocality": "İstanbul","addressCountry": "Turkey"},"email": "fatih@tatoglu.net"}]}</script></head><body><header><h1 id="title">Kurulum</h1><summary></summary></header><nav><i class="menu-icon">&#9776;</i><ul><li><a href="https://blog.tatoglu.net/index.html">Anasayfa</a></li><li><a href="https://blog.tatoglu.net/coaching/index.html">Koçluk</a></li><li><a href="https://blog.tatoglu.net/my-notes/index.html">Notlarım</a></li><li><a href="https://blog.tatoglu.net/lab/index.html">Laboratuvar</a></li><li><a href="https://blog.tatoglu.net/about-me.html">Hakkımda</a></li><li><button id="btnFeedback" class="icon" title="Geri Bildirim">&#128640;</button> <button id="btnDarkTheme" class="icon" title="Koyu Tema">&#127770;</button> <button id="btnLightTheme" class="icon" title="Açık Tema">&#127774;</button> <button id="btnEnglish" class="icon" title="İngilizce">🇺🇸</button></li></ul></nav><main><section><strong>HAProxy</strong><ul><li class="active">Kurulum</li><li><a href=".&#x2F;lab&#x2F;haproxy&#x2F;cluster.html">Cluster</a></li><li><a href=".&#x2F;lab&#x2F;haproxy&#x2F;default-routing.html">Statik Yönlendirme</a></li><li><a href=".&#x2F;lab&#x2F;haproxy&#x2F;ssl-certificate.html">SSL Sertifika</a></li></ul></section><article><p>Bu not, CentOS 7.X Minimal üzerine kaynaktan tek sunucu kurulumu HAProxy adımlarını içerir. Bu kurulum, HAProxy ile ilgili aşağıdaki notlara yardımcı olmak için bazı ekstra adımlar da içerir.</p><p>🔥 Bu not HAProxy 2.0.29 ve Lua 5.3.5 sürümü için yazılmıştır. Daha yeni sürümler farklı konfigürasyonlara sahip olabilir.</p><h2>Ön Hazırlık</h2><table><thead><tr><th align="right">Özellik</th><th align="left">Minimum Değer</th></tr></thead><tbody><tr><td align="right"><strong>Sunucu Adı</strong></td><td align="left">haproxy-01</td></tr><tr><td align="right"><strong>IP Adresi</strong></td><td align="left">172.19.85.102</td></tr><tr><td align="right"><strong>Netmask</strong></td><td align="left">255.255.255.0</td></tr><tr><td align="right"><strong>Gateway</strong></td><td align="left">172.19.85.1</td></tr><tr><td align="right"><strong>CPU</strong> ⭐</td><td align="left">4</td></tr><tr><td align="right"><strong>Bellek</strong> ⭐</td><td align="left">2 GB</td></tr><tr><td align="right"><strong>Disk</strong></td><td align="left">40GB</td></tr><tr><td align="right"><strong>OS</strong></td><td align="left">CentOS 7.X Minimal</td></tr><tr><td align="right"><strong>İnternet Erişimi</strong></td><td align="left">Evet</td></tr></tbody></table><p>⭐: Kurulum işlemi sırasında kaynakları artırabilirsiniz.</p><p>Kurulum ve derleme işlemi sırasında bir <strong>root</strong> kullanıcısına gerek yoktur. Ancak, root ayrıcalıklarına sahip bir kullanıcıya ihtiyaç duyulacaktır. Notta, kurulum ve derleme işlemi için <strong>devops</strong> kullanıcısı kullanılmıştır. Eğer farklı bir kullanıcınız varsa, lütfen onu kullanın.</p><p>Kurulum sırasında engellemeleri önlemek için SELinux devre dışı bırakılmıştır.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo setenforce 0
devops@haproxy-01:~$ sudo sed -i &#39;s/^SELINUX=.*/SELINUX=permissive/g&#39; /etc/selinux/config
</code></pre><h2>Kurulum Hazırlığı</h2><p>Güvenlik nedeniyle, HAProxy için ayrı bir kullanıcı oluşturulmalıdır.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo groupadd -g 1985 haproxy
devops@haproxy-01:~$ sudo useradd -g 1985 -u 1985 -d /var/lib/haproxy -s /sbin/nologin -c haproxy haproxy
</code></pre><p>Aşağıdaki dosyalar indirilmeli ve sıkıştırılmış dosyalardan çıkartılmalıdır.</p><pre><code class="language-shell">devops@haproxy-01:~$ curl https://www.lua.org/ftp/lua-5.3.5.tar.gz &gt; lua-5.3.5.tar.gz
devops@haproxy-01:~$ curl http://www.haproxy.org/download/2.0/src/haproxy-2.0.29.tar.gz &gt; haproxy-2.0.29.tar.gz

devops@haproxy-01:~$ tar xf lua-5.3.5tar.gz
devops@haproxy-01:~$ tar xf haproxy-2.0.29.tar.gz 
</code></pre><p>HAProxy&#39;yi oluşturmaya başlamadan önce, bazı zorunlu kütüphanelerin yüklenmesi gerekir.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo yum install gcc openssl-devel readline-devel systemd-devel make pcre-devel net-tools kernel-headers url libnl3-devel net-snmp-devel -y
devops@haproxy-01:~$ sudo yum update -y
</code></pre><h2>Kurulum</h2><p>Lua kütüphane yolu HAProxy derleme komutu için bir parametre olduğundan derleme işlemi Lua&#39;nın derlenmesi ile başlar.</p><pre><code class="language-shell">devops@haproxy-01:~$ cd lua-5.3.5
devops@haproxy-01:~$ sudo make INSTALL_TOP=/opt/lua-5.3.5 linux install
</code></pre><p>Artık HAProxy kaynaktan oluşturulabilir.</p><pre><code class="language-shell">devops@haproxy-01:~$ cd ~
devops@haproxy-01:~$ cd haproxy-2.0.29
devops@haproxy-01:~$ sudo make USE_NS=1 USE_TFO=1 USE_OPENSSL=1 USE_ZLIB=1 USE_LUA=1 USE_PCRE=1 USE_SYSTEMD=1 USE_LIBCRYPT=1 USE_THREAD=1 TARGET=linux-glibc LUA_INC=/opt/lua-5.3.5/include LUA_LIB=/opt/lua-5.3.5/lib
devops@haproxy-01:~$ sudo make PREFIX=/opt/haproxy install
</code></pre><p>Yukarıdaki parametreler HAProxy&#39;nin genel kullanımı için seçilmiştir, daha spesifik parametrelere ihtiyacınız varsa kaynak koddaki <strong>INSTALL</strong> dosyası içinde yer almaktadır. Lütfen değişen parametrelerin HAProxy performansını ve çalışma şeklini etkilediğini unutmayın.</p><h2>Konfigürasyon</h2><p>HAProxy&#39;yi oluşturduktan sonra, <code>systemctl</code> ile kontrol etmek için bir servis tanımı oluşturulmalıdır.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo vi /etc/systemd/system/haproxy.service
</code></pre><pre><code class="language-ini">[Unit]
Description=HAProxy 2.0.29
After=syslog.target network.target

[Service]
Type=notify
EnvironmentFile=/etc/sysconfig/haproxy
ExecStart=/opt/haproxy/sbin/haproxy -f $CONFIG_FILE -p $PID_FILE $CLI_OPTIONS
ExecReload=/bin/kill -USR2 $MAINPID
ExecStop=/bin/kill -USR1 $MAINPID

[Install]
WantedBy=multi-user.target
</code></pre><p>Şimdi, başlangıç parametrelerini ve seçeneklerini tanımlamak için işlem dosyası oluşturulmalıdır.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo vi /etc/sysconfig/haproxy
</code></pre><pre><code class="language-ini"># Command line options to pass to HAProxy at startup
# The default is:
CLI_OPTIONS=&quot;-Ws&quot;

# Specify an alternate configuration file. The default is:
CONFIG_FILE=/etc/haproxy/haproxy.conf

# File used to track process IDs. The default is:
PID_FILE=/var/run/haproxy.pid
</code></pre><p>Yapılandırma bölümündeki son adım, bir HAProxy yapılandırma dosyası oluşturmaktır. Bu yapılandırma dosyası proxy tanımlarını, servis ve sunucu tanımlarını içerir.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo mkdir /etc/haproxy/
devops@haproxy-01:~$ sudo vi /etc/haproxy/haproxy.conf
</code></pre><pre><code class="language-nestedtext">##################################################
#                    Global                      #
##################################################
global
    daemon
    maxconn     5000
    user        haproxy
    group       haproxy
    chroot      /var/lib/haproxy
    log 127.0.0.1 local0          #traffic logs
    log 127.0.0.1 local1 notice   #event logs

    #SSL option
    tune.ssl.default-dh-param 2048
    ssl-server-verify none
    ssl-default-bind-options no-sslv3

    #Multithreading
    nbproc 1
    nbthread 4
    cpu-map auto:1/1-4 0-3
##################################################


##################################################
#                   Defaults                     #
##################################################
defaults
    log global
    mode http
    option httplog
    option logasap
    timeout connect 4s
    timeout client 5s
    timeout server 86400s
    timeout http-request 30s
    timeout http-keep-alive 5s
    timeout queue 60s

    #server defaults
    default-server inter 1s rise 2 fall 4
    grace 3000

    #request
    option redispatch 1
    retries 2
##################################################


##################################################
#                  Monitoring                    #
##################################################
listen stats
    bind *:1985
    mode http
    stats enable
    stats uri /stats
    stats refresh 3s
    stats show-node
    option dontlog-normal
##################################################


##################################################
#                    Frontend                    #
##################################################

##################################################


##################################################
#                    Backend                     #
##################################################

##################################################


##################################################
#                     Users                      #
##################################################

##################################################
</code></pre><p>Yapılandırma bölümünü tamamlamak için, HAProxy yapılandırmasını doğrulamak için gerekli bir komut vardır.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo /opt/haproxy/sbin/haproxy -c -V -f /etc/haproxy/haproxy.conf
</code></pre><p>Bu komut, HAProxy yapılandırma dosyasındaki herhangi bir yapılandırma değişikliğinden sonra çalıştırılmalıdır.</p><h2>Güvenlik</h2><p>SELinux devre dışıdır, ancak ağ saldırılarını veya keşfedilebilirliği önlemek için güvenlik duvarı etkinleştirilmelidir. Port bazında bir tanımlama yapmak karmaşıklık yaratır, bu nedenle Güvenlik Duvarı için bir HAProxy hizmet tanımı oluşturmak daha iyidir.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo vi /etc/firewalld/services/haproxy.xml
</code></pre><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;service&gt;
    &lt;short&gt;HAProxy&lt;/short&gt;
    &lt;description&gt;HAProxy load-balancer&lt;/description&gt;
    &lt;port protocol=&quot;tcp&quot; port=&quot;80&quot;/&gt;
    &lt;port protocol=&quot;tcp&quot; port=&quot;443&quot;/&gt;
    &lt;port protocol=&quot;tcp&quot; port=&quot;1985&quot;/&gt;
&lt;/service&gt;
</code></pre><p>Normal trafik için <code>80</code> ve <code>443</code> portları eklenmiştir. HAProxy durum sayfası erişimi için <code>1985</code> portu eklenmiştir. Ek portlarınızı ileride bu dosyaya ekleyebilirsiniz. Ekledikten sonra Güvenlik Duvarını ve HAProxy&#39;i yeniden başlatmak gereklidir.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo chmod 640 /etc/firewalld/services/haproxy.xml
</code></pre><h2>Çalıştırma</h2><pre><code class="language-shell">devops@haproxy-01:~$ sudo systemctl enable firewalld
devops@haproxy-01:~$ sudo sudo systemctl start firewalld
devops@haproxy-01:~$ sudo firewall-cmd --permanent --add-service=haproxy
devops@haproxy-01:~$ 
devops@haproxy-01:~$ sudo firewall-cmd --reload
devops@haproxy-01:~$ sudo systemctl enable haproxy
devops@haproxy-01:~$ sudo systemctl start haproxy
</code></pre><p>Yukarıdaki komutlar ile HAProxy&#39;e kalıcı erişim sağlanır ve HAProxy&#39;nin servisi etkinleştirilir ve başlatılır. Eğer herhangi bir sorun yoksa HAProxy çalışmalıdır.</p><h2>Doğrulama</h2><p>Kurulumdan sonra, kurulumu dahili ve harici olarak doğrulamalısınız.</p><pre><code class="language-shell">devops@haproxy-01:~$ sudo systemctl status haproxy
</code></pre><p>Yukarıdaki komutlar dahili doğrulama için <strong>Running</strong> durumunu döndürmelidir. Harici doğrulama için, HAProxy durum sayfası için HAProxy yapılandırma dosyasında tanımlanan <code>http://172.19.85.102:1985/stats</code> adresini ziyaret edebilirsiniz.</p></article></main><footer>&copy; 1985 - <a href="about-me.html" rel="noopener noreferrer" target="_blank">Fatih Tatoğlu</a></footer><script src="https://blog.tatoglu.net/js/main.js?v=96a6c3c79b3d35ef37896ed4f9a413ce"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GSVKFRLFNV&v=96a6c3c79b3d35ef37896ed4f9a413ce"></script><script src="https://blog.tatoglu.net/js/analytics.js?v=96a6c3c79b3d35ef37896ed4f9a413ce"></script><div id="pnlFeedbackSurvey"><div class="model-content"><button id="btnFeedbackSurveyClose" class="icon bold x-small">&times;</button><iframe src="https://docs.google.com/forms/d/e/1FAIpQLSewJ_x10HBlFs2lO2zHUBI3ZeSdEXaISpK292RPJBoZyeC1HA/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe></div></div></body></html>