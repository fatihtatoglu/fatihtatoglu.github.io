<!DOCTYPE html><html lang="tr"><head><base href="https://blog.tatoglu.net/"><meta charset="UTF-8"><meta name="yandex-verification" content="31a29a16b97b37a8"><meta name="msvalidate.01" content="578B5091D7C5A2C03BE2EE0DF0CCC024"><meta name="google-site-verification" content="7pv7CpUtN5qt6uIgrmkOjVK03wSJYs1vQKRiBESB978"><link rel="profile" href="https://gmpg.org/xfn/11"><meta name="description" content="Sanal makine oluşturmak için UI üzerinden çok fazla tıklama yapmam gerekiyor. Bunun yerine bu işlemi powershell ile yapmak daha kolay oluyor."><meta name="author" content="Fatih Tatoğlu"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap&v=d254415dcfdca7f7cdbe2c59784521eb" rel="stylesheet"><link rel="canonical" href="https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html"><link rel="alternate" hreflang="x-default" href="https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html"><link rel="alternate" hreflang="tr" href="https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fatih Tatoğlu - Windows - Sanal Makine Oluşturma</title><link rel="stylesheet" href="https://blog.tatoglu.net/css/main.css?v=d254415dcfdca7f7cdbe2c59784521eb"><link rel="stylesheet" href="https://blog.tatoglu.net/css/custom.css?v=d254415dcfdca7f7cdbe2c59784521eb"><link rel="stylesheet" href="https://blog.tatoglu.net/css/3024.css?v=d254415dcfdca7f7cdbe2c59784521eb"><script src="https://blog.tatoglu.net/js/main.js?v=d254415dcfdca7f7cdbe2c59784521eb"></script><script src="https://blog.tatoglu.net/js/analytics.js?v=d254415dcfdca7f7cdbe2c59784521eb"></script><link rel="apple-touch-icon" sizes="180x180" href="https://blog.tatoglu.net/image/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blog.tatoglu.net/image/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blog.tatoglu.net/image/favicon/favicon-16x16.png"><link rel="manifest" href="https://blog.tatoglu.net/image/favicon/site.webmanifest"><link rel="icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://blog.tatoglu.net/favicon.ico" type="image/x-icon"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@fatihtatoglu"><meta name="twitter:title" content="Windows - Sanal Makine Oluşturma"><meta name="twitter:description" content="Sanal makine oluşturmak için UI üzerinden çok fazla tıklama yapmam gerekiyor. Bunun yerine bu işlemi powershell ile yapmak daha kolay oluyor."><script type="application/ld+json">{"@context": "https://schema.org","@graph": [{"@type": "WebSite","@id": "https://blog.tatoglu.net/#website","url": "https://blog.tatoglu.net/","name": "Fatih Tatoğlu","description": "Fatih Tatoğlu - Kişisel Web Sayfası","publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"inLanguage": ""},{"@type": "WebPage","@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#webpage","url": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html","name": "Windows - Sanal Makine Oluşturma - Fatih Tatoğlu","isPartOf": {"@id": "https://blog.tatoglu.net/#website"},"datePublished": "2022-06-12T21:28:33+0000","breadcrumb": {"@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#breadcrumb"},"inLanguage": "","potentialAction": [{"@type": "ReadAction","target": ["https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html"]}]},{"@type": "BreadcrumbList","@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#breadcrumb","itemListElement": [{"@type": "ListItem","position": 1,"name": "Ana sayfa","item": "https://blog.tatoglu.net/"},{"@type": "ListItem","position": 2,"name": "Windows - Sanal Makine Oluşturma"}]},{"@type": "Article","@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#article","isPartOf": {"@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#webpage"},"author": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"headline": "Windows - Sanal Makine Oluşturma","datePublished": "2022-06-12T21:28:33+0000","mainEntityOfPage": {"@id": "https://blog.tatoglu.net/lab/windows/sanal-makine-olusturma.html/#webpage"},"publisher": {"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034"},"keywords": ["powershell","hyper-v","sanal makine"],"inLanguage": ""},{"@type": ["Person"],"@id": "https://blog.tatoglu.net//#/schema/person/9112274035621a3fbf80e30c19216034","name": "Fatih Tatoğlu","url": "https://blog.tatoglu.net/about-me.html","image": {"@type": "ImageObject","@id": "https://blog.tatoglu.net/#personlogo","inLanguage": "","url": "https://blog.tatoglu.net/image/about_me.jpg","contentUrl": "https://blog.tatoglu.net/image/about_me.jpg","width": 1024,"height": 683,"caption": "Fatih Tatoğlu"},"address": {"@type": "PostalAddress","addressLocality": "İstanbul","addressCountry": "Turkey"},"email": "fatih@tatoglu.net"}]}</script></head><body><header><span class="site-name">Fatih Tatoğlu</span></header><nav id="navigation"><span class="menu-button">▼</span><ul><li><a href="javascript:;">-</a><div class="sub-menu"><ul><li><a id="btnSetting" href="javascript:;">Tema Ayarları</a></li></ul></div></li><li><a href="https://blog.tatoglu.net/index.html">Anasayfa</a></li><li><a href="https://blog.tatoglu.net/kocluk/index.html">Koçluk</a></li><li><a href="https://blog.tatoglu.net/projeler/index.html">Projeler</a></li><li><a href="https://blog.tatoglu.net/kendime-notlar/index.html">Kendime Notlar</a></li><li><a href="https://blog.tatoglu.net/lab/index.html">Laboratuvar</a></li><li><a href="https://blog.tatoglu.net/hakkimda.html">Hakkımda</a></li></ul></nav><main><article data-clarity-region="article"><header><h1>Windows - Sanal Makine Oluşturma</h1><button>#</button></header><p>Sanal makine oluşturmak için UI üzerinden çok fazla tıklama yapmam gerekiyor. Bunun yerine bu işlemi powershell ile yapmak daha kolay oluyor. Bu notumda powershell ile sanal makine kurmayı anlatmaya çalışacağım.</p><h2>Network Ayarlama</h2><p>Sanal sunucuların internete erişmesi ve ana makine ile birlikte iletişimde kalabilmesi için network ayarının doğru yapılması gerekiyor. Bu işlem için aşağıdaki komutları çalıştırmak yeterli olacaktır.</p><pre><code class="hljs language-powershell"><span class="hljs-variable">$natSwitch</span>     = <span class="hljs-string">&quot;NATSwitch&quot;</span>
<span class="hljs-variable">$natIPAddress</span>  = <span class="hljs-string">&quot;172.19.85.1&quot;</span>
<span class="hljs-variable">$natAddress</span>    = <span class="hljs-string">&quot;172.19.85.0/24&quot;</span>

<span class="hljs-built_in">New-VMSwitch</span> <span class="hljs-literal">-SwitchName</span> <span class="hljs-variable">$natSwitch</span> <span class="hljs-literal">-SwitchType</span> Internal
<span class="hljs-built_in">New-NetIPAddress</span> <span class="hljs-literal">-IPAddress</span> <span class="hljs-variable">$natIPAddress</span> <span class="hljs-literal">-PrefixLength</span> <span class="hljs-number">24</span> <span class="hljs-literal">-InterfaceAlias</span> <span class="hljs-string">&quot;vEthernet (<span class="hljs-variable">$natSwitch</span>)&quot;</span>

<span class="hljs-built_in">New-NetNAT</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$natSwitch</span> <span class="hljs-literal">-InternalIPInterfaceAddressPrefix</span> <span class="hljs-variable">$natAddress</span>

<span class="hljs-built_in">Set-DnsClientServerAddress</span> <span class="hljs-literal">-InterfaceAlias</span> <span class="hljs-string">&quot;vEthernet (<span class="hljs-variable">$natSwitch</span>)&quot;</span> <span class="hljs-literal">-ServerAddresses</span> (<span class="hljs-string">&quot;8.8.8.8&quot;</span>,<span class="hljs-string">&quot;1.1.1.1&quot;</span>)
</code></pre><p>Yukarıdaki komutta <strong><code>$natSwitch</code></strong> değişkeni sanal network kartının adını belirtmektedir. <strong><code>$natIPAddress</code></strong> değişkeni sanal networkün IP adresini belirtmektedir. Bu değeri kuracağımız sanal makinelerde gateway olarak ta kullanacağız. <strong><code>$natAddress</code></strong> değişkeni de sanal networkün gemişliğini belirlemek için kullanılmaktadır. /24 değeri ile 254 tane IP adresi atanabilmesini sağlamış oluyoruz. Bu değeri kuracağımız sanal makinede de 24 olarak giriyor olacağız. Bu sayede aynı network genişliğinde çalışabiliyor olacaklar.</p><p>Sanal networke DNS olarak istediğimizi tanımlayabiliriz ben makinemden dışarı çıkarken Google ve CloudFlare DNS lerini tercih ettim.</p><h2>Makine Ayarlama</h2><pre><code class="hljs language-powershell"><span class="hljs-variable">$natSwitch</span> = <span class="hljs-string">&quot;NATSwitch&quot;</span>
<span class="hljs-variable">$vmGroup</span> = <span class="hljs-string">&quot;fatihtatoglu&quot;</span>
<span class="hljs-variable">$vmName</span> = <span class="hljs-string">&quot;fth-linux&quot;</span>
<span class="hljs-variable">$workspacePath</span> = <span class="hljs-string">&quot;C:\\workspace\\servers\\&quot;</span>

<span class="hljs-variable">$ramSize</span>  = <span class="hljs-number">2</span>GB 
<span class="hljs-variable">$diskSize</span> = <span class="hljs-number">50</span>GB


<span class="hljs-built_in">New-VHD</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;<span class="hljs-variable">$workspacePath</span>\\<span class="hljs-variable">$vmGroup</span>\\<span class="hljs-variable">$vmName</span>\\<span class="hljs-variable">$vmName</span>.vhdx&quot;</span> <span class="hljs-literal">-SizeBytes</span> <span class="hljs-variable">$diskSize</span> <span class="hljs-literal">-Fixed</span> <span class="hljs-literal">-BlockSizeBytes</span> <span class="hljs-number">1</span>MB

<span class="hljs-built_in">New-VM</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-MemoryStartupBytes</span> <span class="hljs-variable">$ramSize</span> <span class="hljs-literal">-BootDevice</span> VHD <span class="hljs-literal">-VHDPath</span> <span class="hljs-string">&quot;<span class="hljs-variable">$workspacePath</span>\\<span class="hljs-variable">$vmGroup</span>\\<span class="hljs-variable">$vmName</span>\\<span class="hljs-variable">$vmName</span>.vhdx&quot;</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;<span class="hljs-variable">$workspacePath</span>\\<span class="hljs-variable">$vmGroup</span>&quot;</span> <span class="hljs-literal">-Generation</span> <span class="hljs-number">2</span> <span class="hljs-literal">-Switch</span> <span class="hljs-variable">$natSwitch</span>

<span class="hljs-built_in">Set-VMFirmware</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-EnableSecureBoot</span> Off
<span class="hljs-built_in">Set-VMProcessor</span> <span class="hljs-literal">-VMName</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-Count</span> <span class="hljs-number">2</span>
<span class="hljs-built_in">Set-VM</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-AutomaticCheckpointsEnabled</span> <span class="hljs-variable">$false</span> <span class="hljs-literal">-CheckpointType</span> Disabled
<span class="hljs-built_in">Set-VMMemory</span> <span class="hljs-literal">-VMName</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-DynamicMemoryEnabled</span> <span class="hljs-variable">$true</span> <span class="hljs-literal">-MinimumBytes</span> (<span class="hljs-variable">$ramSize</span> / <span class="hljs-number">16</span>) <span class="hljs-literal">-StartupBytes</span> (<span class="hljs-variable">$ramSize</span> / <span class="hljs-number">8</span>) <span class="hljs-literal">-MaximumBytes</span> <span class="hljs-variable">$ramSize</span>

<span class="hljs-built_in">Add-VMDvdDrive</span> <span class="hljs-literal">-VMName</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;C:\\workspace\\isos\\linuxmint-20.3-xfce-64bit.iso&quot;</span>

<span class="hljs-variable">$dvd</span> = <span class="hljs-built_in">Get-VMDVDDrive</span> <span class="hljs-literal">-VMName</span> <span class="hljs-variable">$vmName</span>
<span class="hljs-built_in">Set-VMFirmware</span> <span class="hljs-literal">-VMName</span> <span class="hljs-variable">$vmName</span> <span class="hljs-literal">-FirstBootDevice</span> <span class="hljs-variable">$dvd</span>

<span class="hljs-variable">$computer</span> = hostname
<span class="hljs-built_in">Start-VM</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$vmName</span>
<span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Seconds</span> <span class="hljs-number">3</span>
vmconnect.exe <span class="hljs-variable">$computer</span> <span class="hljs-variable">$vmName</span>
</code></pre><p>Yukarıdaki komut yeni bir sanal makine için sabit bir disk oluşturup, sonrasında makinenin kurulması için gereken tanımları yapıp, sonrasında makineyi çalıştırmaktadır. Bu sayede elle tek tek yapacağım işleri çok daha hızlı olarak yapabilmekteyim.</p><p>Parametreleri değiştirerek daha farklı makineler kurulabilir.</p><h2>Son Adım</h2><p>En son adım olarak makinelerin kurulumu bittikten sonra ana makine ile bağlatıyı sağlamak için host dosyasına ekleme yapılması işinizi kolaylaştıracaktır.</p><pre><code class="hljs language-shell">notepad %systemroot%\system32\drivers\etc\hosts
</code></pre><h2>Sanal Makine Ayarı</h2><p><img src="image/linux-mint-eth0.png" alt="Linux Mint Ethernet" title="Linux Mint Ethernet"></p><p>Sanal makinenin içerisinde olacak ayarladan da ufak bahsetmem gerekeceğini düşündüm. Görselde görüldüğü gibi <strong>NetMask</strong> ve <strong>Gateway</strong> tanımları sanal network ile aynı olacak şekilde. Sadece dikkat edilmesi gereken konu ise <strong>DNS Server</strong> değerinin ana makinenin gateway değeri olarak güncellenmesi. Bu işlem yapılmadığında sanal makine internete çıkabiliyor ama DNS çözümlemesi yapamıyor. Bununla ilgili olarak bazı denemeler de yaptım ama başarılı olarak çalışan iki denemem oldu.</p><ol><li>Ana makinenin gateway değerinin DNS olarak girilmesi.</li><li>Ana makinenin gatewayi ile aynı networkte olan bir DNS sunucusunun DNS olarak tanımlanması.</li></ol><footer>By <a href="about-me.html" rel="noopener noreferrer" target="_blank">Fatih Tatoğlu</a> - <time pubdate datetime="2022-06-12T21:28:33+0000" title="12.06.2022">12.06.2022</time></footer></article></main><footer><span class="credits">Fatih Tatoğlu &copy; 1985</span></footer><div id="pnlSettingDialog" class="dialog"><div class="dialog-box"><div class="dialog-content"><header><button>■</button><span>Tema Ayarları</span></header><main><table style="margin: auto;"><thead><th style="width: 150px;">Renkler</th></thead><tbody><tr><td style="text-align: left; padding-left: 5%;"><input id="rbColoraqua" name="color" type="radio" value="aqua"> <label for="rbColoraqua">Aqua</label><br><input id="rbColorblack" name="color" type="radio" value="black"> <label for="rbColorblack">Black</label><br><input id="rbColorblue" name="color" type="radio" value="blue"> <label for="rbColorblue">Blue</label><br><input id="rbColorwhite" name="color" type="radio" value="white"> <label for="rbColorwhite">White</label></td></tr></tbody></table><br></main><footer><button id="btnSettingDialogOK" class="default" accesskey="t"><u>T</u>amam</button></footer></div></div></div></body></html>