---
layout: post
published: true
author: Fatih TatoÄŸlu
date: 2023-10-27T21:37:00Z
permalink: ./lab/environment/hyperv.html
language: tr

title: Hyper-V ile Sanal Makine OluÅŸturma
header: Hyper-V ile Sanal Makine OluÅŸturma
description: Fatih'in alÄ±ÅŸkanlÄ±k ve tercihlerine uygun bir yazÄ±lÄ±m geliÅŸtirme ortamÄ± hazÄ±rlamak.
tags: powershell hyper-v sanal_makine

category: lab
group: environment
groupTitle: GeliÅŸtirme OrtamÄ±
order: 2
---

Ortam kurulumunun hazÄ±rlÄ±ÄŸÄ±nÄ± tamamladÄ±ktan sonra, geliÅŸtirmeye baÅŸlamak iÃ§in bir sanal makineye ihtiyacÄ±m var. BirÃ§ok butona tÄ±klamak yerine Powershell kullanmayÄ± tercih ediyorum.

## AÄŸ AyarlamasÄ±

Ä°nternete ulaÅŸmak veya ana bilgisayar ve diÄŸer sanal makinelerle iletiÅŸim kurmak iÃ§in Ã¶ncelikle aÄŸ ayarlarÄ± yapÄ±lmalÄ±dÄ±r.

```powershell
PS C:\Users\Fatih TatoÄŸlu> $natSwitch     = "NATSwitch"
PS C:\Users\Fatih TatoÄŸlu> $natIPAddress  = "172.19.85.1"
PS C:\Users\Fatih TatoÄŸlu> $natAddress    = "172.19.85.0/24"
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> New-VMSwitch -SwitchName $natSwitch -SwitchType Internal
PS C:\Users\Fatih TatoÄŸlu> New-NetIPAddress -IPAddress $natIPAddress -PrefixLength 24 -InterfaceAlias "vEthernet ($natSwitch)"
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> New-NetNAT -Name $natSwitch -InternalIPInterfaceAddressPrefix $natAddress
```

YukarÄ±daki komutlar ile bir virtual switch oluÅŸturulacaktÄ±r. Ben `172.19.85.0/24` IP aralÄ±ÄŸÄ±nÄ± seÃ§tim ama istek ve ihtiyaÃ§lara gÃ¶re deÄŸiÅŸtirilebilir.

## Sanal Makine OluÅŸturmak

```powershell
PS C:\Users\Fatih TatoÄŸlu> $natSwitch = "NATSwitch"
PS C:\Users\Fatih TatoÄŸlu> $vmName = "fth-dev"
PS C:\Users\Fatih TatoÄŸlu> $workspacePath = "C:\\workspace\\machine\\"
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> $ramSize  = 8GB 
PS C:\Users\Fatih TatoÄŸlu> $diskSize = 50GB
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> New-VHD -Path "$workspacePath\\$vmName\\$vmName.vhdx" -SizeBytes $diskSize -Fixed -BlockSizeBytes 1MB
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> New-VM -Name $vmName -MemoryStartupBytes $ramSize -BootDevice VHD -VHDPath "$workspacePath\\$vmName\\$vmName.vhdx" -Path "$workspacePath" -Generation 2 -Switch $natSwitch
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> Set-VMFirmware $vmName -EnableSecureBoot Off
PS C:\Users\Fatih TatoÄŸlu> Set-VMProcessor -VMName $vmName -Count 2
PS C:\Users\Fatih TatoÄŸlu> Set-VM -Name $vmName -AutomaticCheckpointsEnabled $false -CheckpointType Disabled
PS C:\Users\Fatih TatoÄŸlu> Set-VMMemory -VMName $vmName -DynamicMemoryEnabled $true -MinimumBytes ($ramSize / 16) -StartupBytes ($ramSize / 8) -MaximumBytes $ramSize
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> Add-VMDvdDrive -VMName $vmName -Path "C:\\workspace\\iso\\linuxmint-21.2-xfce-64bit.iso"
PS C:\Users\Fatih TatoÄŸlu> 
PS C:\Users\Fatih TatoÄŸlu> $dvd = Get-VMDVDDrive -VMName $vmName
PS C:\Users\Fatih TatoÄŸlu> Set-VMFirmware -VMName $vmName -FirstBootDevice $dvd
PS C:\Users\Fatih TatoÄŸlu> Start-VM -Name $vmName
```

YukarÄ±daki komutlar ile sanal disk oluÅŸturulacaktÄ±r. Daha sonra sanal makine dÃ¼zenlenir ve son olarak makine baÅŸlatÄ±lÄ±r.

ğŸ”¥ Parametre deÄŸiÅŸtirilerek farklÄ± sanal makineler oluÅŸturulabilir. Ã–te yandan, bu sanal makineler temel ve boÅŸ makinelerdir. AÄŸ ayarlarÄ±nÄ± manuel olarak ayarlamayÄ± unutmayÄ±n.

AÅŸaÄŸÄ±daki komut uygulanÄ±rsa, ana makine konuk makineye baÄŸlanacaktÄ±r.

```powershell
PS C:\Users\Fatih TatoÄŸlu> $computer = hostname
PS C:\Users\Fatih TatoÄŸlu> vmconnect.exe $computer $vmName
```

## Sanal Makine AyarlarÄ±

Sanal makinenin aÄŸ ayarÄ±nÄ±n zor olabileceÄŸi farklÄ± senaryolarÄ± deneyimleyerek Ã¶ÄŸrendim. Benim ortamÄ±mda, DNS ana bilgisayarÄ±n aÄŸ geÃ§idi IP adresi ile aynÄ± atanmalÄ±dÄ±r. Ã–rneÄŸin, ana bilgisayarÄ±n aÄŸ geÃ§idi IP adresi `192.168.6.1` ise. Sanal makinenin DNS IP adresi `192.168.6.1` olmalÄ±dÄ±r. DNS sunucusu IP adresleri, geÃ§erli bir DNS sunucusu bulunmuÅŸsa kullanÄ±labilir.
